# TermiHUI Server

Серверная часть проекта TermiHUI для управления терминальными сессиями через PTY.

## Особенности

- **Асинхронное выполнение команд** через `forkpty`
- **Неблокирующее чтение вывода** с использованием `fcntl` + `poll`
- **Буферизация данных** для эффективной работы
- **Проверка состояния процессов** в реальном времени
- **Кроссплатформенность** (macOS/Linux)

## Структура проекта

```
server/
├── CMakeLists.txt              # Конфигурация сборки
├── src/
│   ├── TerminalSession.h       # Заголовочный файл класса
│   ├── TerminalSession.cpp     # Реализация класса
│   └── main.cpp               # CLI демонстрация
└── README.md                  # Этот файл
```

## Сборка

### Требования

- CMake 3.15+
- C++17 совместимый компилятор (GCC, Clang)
- libutil (для forkpty)

### Команды сборки

```bash
cd server
mkdir build
cd build
cmake ..
make
```

### Запуск

```bash
./termihui-server
```

## Использование класса TerminalSession

```cpp
#include "TerminalSession.h"

// Создание сессии
TerminalSession session;

// Запуск команды
if (session.startCommand("ls -la")) {
    // Чтение вывода
    while (session.isRunning()) {
        if (session.hasData(100)) {
            std::string output = session.readOutput();
            std::cout << output;
        }
    }
}

// Отправка ввода (для интерактивных команд)
session.sendInput("echo 'Hello World!'\n");

// Завершение сессии
session.terminate();
```

## API класса TerminalSession

### Основные методы

- `startCommand(command)` - Запуск команды в PTY
- `sendInput(input)` - Отправка текста в PTY
- `readOutput()` - Чтение доступного вывода
- `isRunning()` - Проверка активности процесса
- `terminate()` - Принудительное завершение

### Вспомогательные методы

- `getChildPid()` - Получение PID дочернего процесса
- `getPtyFd()` - Получение файлового дескриптора PTY
- `hasData(timeout)` - Проверка доступности данных

## Планируемые улучшения (TODO)

### Терминальные функции
- [ ] Передача resize-событий (`struct winsize`)
- [ ] Определение окончания команд по паттерну промпта
- [ ] Поддержка цепочки команд с sudo
- [ ] История команд и сессий

### Интеграция
- [ ] WebSocket-сервер для удаленного доступа
- [ ] AI-интеграция для анализа вывода команд
- [ ] Система мониторинга и логирования
- [ ] Множественные сессии

### Безопасность
- [ ] Аутентификация и авторизация
- [ ] Ограничения команд (whitelist/blacklist)
- [ ] Chroot окружение
- [ ] Контроль ресурсов

## Архитектура

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Client App    │───▶│ TerminalSession  │───▶│   PTY Process   │
│ (WebSocket/AI)  │    │     (C++)        │    │   (bash/cmd)    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌──────────────────┐
                       │   Buffer/Queue   │
                       │   (Output)       │
                       └──────────────────┘
```

## Лицензия

Проект разрабатывается для внутреннего использования. 